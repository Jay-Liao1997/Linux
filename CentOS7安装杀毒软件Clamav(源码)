使用源码安装的方式安装杀毒软件Clamav

安装过程要解决的依赖有一个 ： libcurl

#下载clamav源码包
  wget http://www.clamav.net/downloads/production/clamav-0.102.3.tar.gz
  
#常规的源码安装方式，configure时会提示有依赖没有安装libcurl

#获取依赖的源码包
  wget https://curl.haxx.se/download/curl-7.71.1.tar.gz
  我安装第一遍时，安装没有问题，但是回到clamav加依赖路径时，还是说我依赖没有安装，于是我删除了curl，又装了一遍，而且我把路径名字改了，改为/usr/local/libcurl
  再次回到clamav用with添加依赖路径时，就成功了。不知道是第二次安装使得成功，还是改了个名libcurl成功了，因为之前报错显示需要libcurl，路径写curl他可能找不到，
  所以我就改了试试，最后成功安装clamav
  
成功安装后当然是想要启动这个服务，因为是源码包，肯定要用绝对路径启动，直接find clamav 居然找不到，后来只能根据路径去找，
最终在/usr/local/clamav/sbin/clamd找到了这个启动命令，原来不叫clamav，怪不得find不到。

根据这个教程https://www.cnblogs.com/chunguang/p/5668798.html说要注释这两个文件里面的Example,然后更新病毒库才能启动服务，但是却发现他们说的路径下没有那个文件，
他们是rpm或者yum安装，估计路径跟我不一样，于是我find去找，居然没有结果，崩溃。

尝试直接启动服务看看，发现报错ERROR: Can't open/parse the config file /usr/local/clamav/etc/clamd.conf。
这个报错提供了线索，我直接到/usr/local/clamav/etc/下面看了看，发现居然找到了参考教程里面说的两个文件，怪不得我find不到，原来文件名不一样，居然加了个example后缀。
随后赶紧进去注释了分别Example，这下应该行了吧。

不对，差点忘了参考教程说要更新病毒库freshcalm,但是显然我是无法直接使用命令的，再次找到绝对路径，
这次有freshcalm的绝对路径，不错，试试看。
发现报错：ERROR: Can't open/parse the config file /usr/local/clamav/etc/freshclam.conf，还是这问题。。。。

突然想起是不是权限的问题，赶紧给了所有权限，启动，还是不行，

猛然醒悟，会不会文件名的问题！
我用mv命令把两个文件的重命名，也就是把example后缀去掉，再次进行更新病毒库： 
/usr/local/clamav/bin/freshclam
WARNING: Can't get information about user clamav.
ERROR: Failed to switch to clamav user.
ERROR: Initialization error!

又报错，但是已经不是之前的错，说明修改文件名的操作生效了！
报错说没有user，这还不简单，我给他useradd一个，再次更新病毒库：
/usr/local/clamav/bin/freshclam
ERROR: Database directory does not exist: /usr/local/clamav/share/clamav/
ERROR: initialize: libfreshclam init failed.
ERROR: Initialization error!

还是报错！但是错误发生改变，说明刚刚的错误解决了，这个错误说有个目录不存在，那也简单，我给他到对应的目录mkdir一个clamav，再次更新一下病毒库：
/usr/local/clamav/bin/freshclam
ClamAV update process started at Mon Jul 13 19:19:01 2020
ERROR: Can't create temporary directory /usr/local/clamav/share/clamav/tmp.02d57
Hint: The database directory must be writable for UID 1004 or GID 1011
ERROR: Update failed.

还报错。。。。。不过报错越来越明显，说的是权限问题，应该是刚刚创建的目录权限不够，我直接给777  chmod 777 clamav/，再次更新病毒库：
 /usr/local/clamav/bin/freshclam
 
 终于成功了！病毒库在更新了！
 
 更新完之后我继续启动服务：/usr/local/clamav/sbin/clamd 
 ERROR: Please define server type (local and/or TCP).
 
又又又报错。。。。。这下没法看了，直接百度
有个相似的教程，试试看：（https://blog.csdn.net/llwang_10/article/details/78686188）
#cd /usr/local/clamav/etc
#vi clamd.conf
取消掉TCPSocket的注释，再次启动clamd
#clamd

搞完之后，当然我还是的使用绝对路径启动，这次什么也没有弹出来！！！！！！！！！！！！！
ps aux | grep clamd
有进程！！！真的成功了！！！！！！！！！！！！！！！！
！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！




总结：这次源码安装给了我很多启发，源码安装本来就会比较麻烦，但是也非常考验与机器互动的能力，这次安装让我意识到有些东西不是不能改的，
      不能太死板，根据机器的回显灵活处理，保持耐心，慢慢处理，实在不行，重装！






  
  
